{"characterId":52270,"noteId":49,"linkItemType":null,"linkKey":"0x0000000000000000000000000000000000000000000000000000000000000000","deleted":false,"locked":false,"contractAddress":"0x0000000000000000000000000000000000000000","uri":"ipfs://bafkreifi7v3tzwidyik7m54mfse3tulfrapawxwdunptq3nmx6s4fpr63u","operator":"0x679658be03475d0a5393c70ea0e9a1158dfae1ff","owner":"0x679658be03475d0a5393c70ea0e9a1158dfae1ff","createdAt":"2023-04-05T06:39:04.000Z","updatedAt":"2023-04-05T11:25:35.000Z","deletedAt":null,"publishedAt":"2022-01-30T14:30:17.000Z","transactionHash":"0xdc576b85b753d220cd2851aa2bc5e951b6f739ada0a82dfd613ec82afbd0296e","blockNumber":30317649,"logIndex":15,"updatedTransactionHash":"0x4efedb1fb8432336ec812f4c088bf67754fdaa4af843821202a9e96cf29cb068","updatedBlockNumber":30334840,"updatedLogIndex":0,"metadata":{"uri":"ipfs://bafkreifi7v3tzwidyik7m54mfse3tulfrapawxwdunptq3nmx6s4fpr63u","type":"NOTE","content":{"tags":["post","前端","图像编码","Web多媒体","青训营"],"type":"note","title":"青训营 |「Web多媒体入门」笔记","content":"---\ntitle: 青训营 |「Web多媒体入门」笔记\nlink: note/front-end/bytedance-note/web-multimedia-introduction\ncatalog: true\ndate: 2022-01-30 14:30:17\nsubtitle: 本节课老师科普了Web多媒体技术的基本概念，如编码格式、封装格式、多媒体元素、流媒体协议等，并阐述了Web多媒体的多种应用场景\nlang: cn\ntags:\n- 前端\n- 图像编码\n- Web多媒体\ncategories:\n- [笔记, 青训营笔记]\n---\n\n# Web多媒体历史\n\n- PC时代：Flash等播放插件，富客户端。\n- 移动互联网时代：Flash等逐渐被淘汰，HTML5出现了，但其支持视频格式等有限\n- Media Source Extensions ，支持多种视频格式等\n\n# 基础知识\n\n## 编码格式\n\n### 图像基本概念\n\n- **图像分辨率**：用于确定组成一副图像的像素数据，就是指在**水平和垂直方向上图像所具有的像素个数**。\n- **图像深度**：图像深度是指**存储每个像素所需要的比特数**。图像深度决定了图像的每个像素**可能的颜色数**，或可能的灰度级数。\n  - 例如，彩色图像每个像素用R,G,B三个分量表示，**每个分量用8位**，**像素深度为24位**，可以表示的颜色数目为2的24次方，既16777216个；\n  - 而一副**单色**图像存储每个像素需要8bit,则图像的**像素深度为8位**，最大灰度数目为2的8次方，既**256**个。\n- 图像分辨率与图像深度共同决定了图像所占的大小~\n\n### 视频基本概念\n\n- 分辨率：**每一帧**的图像分辨率\n- **帧率**：视频**单位时间**内包含的视频**帧的数量**\n- **码率**：就是指**视频单位时间内传输数据量**，一般我们用**kbps**来表示， 即**千位每秒**。\n- 分辨率、帧率与码率共同决定视频的大小\n\n### 视频帧的分类\n\nI帧、P帧、B帧\n\n**I帧（帧内编码帧）**：**自带全部信息**的独立帧，**独立**进行解码，不依赖其他帧\n\n**P帧（前向预测编码帧）**：**参考**前面的 I帧 或者 P帧 才能进行编码\n\n**B帧（双向预测编码帧）**：依赖前面与后面的帧，本帧与前后帧的差别\n\n1 -> 2 -> 3 ->.....\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fcd4aa649e144a3bb7eaf6f0f8ac2ceb~tplv-k3u1fbpfcp-watermark.image?)\n\n> DTS（Decode Time Stamp）解码时间戳：决定bit流什么时候开始送入解码器中进行解码。\n>\n> PTS（Presentation Time Stamp）显示时间戳：决定解码后的视频帧什么时候被显示出来\n>\n> 在没有B帧存在的情况下DTS的顺序和PTS的顺序应该是一样的\n\n### GOP(group of picture)\n\n两个 I帧 之间的间隔，通常在2~4s\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbe3576fcea94d15b56c58c69ce857f7~tplv-k3u1fbpfcp-watermark.image?)\n\nI帧比较多的话，视频就会比较大\n\n### 为什么要编码？\n\n视频分辨率：1920 × 1080\n\n那么视频里一张图片大小：1920 × 1080× 24/8 = 6220800Byte(5.2M)\n\n那么帧率为30FPS、时长90分钟的这样一个视频，占用大小：**933G**，**太大了！**\n\n更别说更高的60FPS了……\n\n编码都压缩掉了些什么呢？\n\n- 首先是**空间冗余**：\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06ef1d1a6add438a9230c3645b153833~tplv-k3u1fbpfcp-watermark.image?)\n\n- **时间冗余**：↓只有球的位置发生了变化，其他的都没有变化\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eca3ad131e344b9daf3f188f276aaa29~tplv-k3u1fbpfcp-watermark.image?)\n\n- **编码冗余**：如图的图像，可以蓝色用1白色用0来表示（因为只有这两种颜色，艾特某哈夫曼编码方式）\n\n  ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4645bf9109fd4e92917c39544e297080~tplv-k3u1fbpfcp-watermark.image?)\n\n  \n\n- **视觉冗余**\n\n  ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06e0df32ec1d4fbc9c780cd90749b25e~tplv-k3u1fbpfcp-watermark.image?)\n\n### 编码数据处理流程\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43dfe562ac5142dabfcf18a4fc1407b2~tplv-k3u1fbpfcp-watermark.image?)\n\n通过**预测**去除空间和时间冗余 -> 变换 去除空间冗余 \n\n- **量化** 去除视觉冗余 ：把视觉系统看不太到了的东西去掉\n- **熵编码** 去除编码冗余：出现频率高的，编码字符所需长度小\n\n## 封装格式\n\n上述视频编码存储的只是单纯的视频信息\n\n封装格式：存储音视频、图片或者字幕信息的一种容器\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20164c0c9cf94203966253b7592f05d2~tplv-k3u1fbpfcp-watermark.image?)\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/429a385de6bc4cd189a250c9706c6d3f~tplv-k3u1fbpfcp-watermark.image?)\n\n## 多媒体元素和扩展API\n\n### video & audio\n\n[`<video>`](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video) 标签用于在HTML或者XHTML文档中嵌入媒体播放器，用于支持文档内的视频播放。\n\n```html\n<!DOCTYPE html>\n<html>\n<body>\n    <video src=\"./video.mp4\" muted autoplay controls width=600 height=300></video>\n    <video muted autoplay controls width=600 height=300>\n        <source src=\"./video.mp4\"></source>\n    </video>\n</body>\n</html>\n```\n\n[`<audio>`](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/audio)  元素用于在文档中嵌入音频内容。\n\n\n```html\n<!DOCTYPE html> \n<html>\n<body>\n    <audio src=\"./auido.mp3\" muted autoplay controls width=600 he ight=300></audio>\n    <audio muted autoplay controls width=600 height=300>\n    \t<source src=\" ./audio.mp3\"></source>\n    </audio>\n</body>\n</html>\n```\n[HTMLMediaElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement)\n\n| 方法                                                         | 描述                                  |\n| ------------------------------------------------------------ | ------------------------------------- |\n| [play()](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/play) | 开始播放音/视频（**异步的**）         |\n| [pause()](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/pause) | 暂停当前播放的音/视频                 |\n| [load()](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/load) | 重新加载音/视频元素                   |\n| [canPlayType()](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/canPlayType) | 检测浏览器是否能播放指定的音/视频类型 |\n| addTextTrack()                                               | 向音视频添加新的文本轨道              |\n\n| 属性         | 描述                                                 |\n| ------------ | ---------------------------------------------------- |\n| autoplay     | 设置或返回是否在加载完成后**自动播放**视频。         |\n| controls     | 设置或返回音频/视频**是否显示控件**(比如播放/暂停等) |\n| currentTime  | 设置或返回音频/视频中的**当前播放位置**(以秒计)      |\n| duration     | 返回当前音频/视频的**长度**(以秒计)                  |\n| src          | 设置或返回音频/视频元素的**当前来源**                |\n| volume       | 设置或返回音频/视频的**音量**                        |\n| buffered     | 返回表示音频/视频**已缓冲部分**的TimeRanges对象      |\n| playbackRate | 设置或返回音频/视频播放的**速度**。                  |\n| error        | 返回表示音频/视频错误状态的**MediaError对象**        |\n| readyState   | 返回音频/视频当前的**就绪状态**。                    |\n| ...          | ...                                                  |\n\n| 事件           | 描述                                           |\n| -------------- | ---------------------------------------------- |\n| loadedmetadata | 当浏览器已加载音频/视频的元数据时触发          |\n| canplay        | 当浏览器可以开始播放音频/视频时触发            |\n| play           | 当音频/视频已开始或不再暂停时触发              |\n| playing        | 当音频/视频在因缓冲而暂停或停止后已就绪时触发  |\n| pause          | 当音频/视频已暂停时触发                        |\n| timeupdate     | 当目前的播放位置已更改时触发                   |\n| seeking        | 当用户开始移动/跳跃到音频/视频中的新位置时触发 |\n| seeked         | 当用户已移动/跳跃到音频/视频中的新位置时触发   |\n| waiting        | 当视频由于需要缓冲下一帧而停止时触发           |\n| ended          | 当目前的播放列表已结束时触发                   |\n| ...            | ...                                            |\n\n#### 缺陷\n\n- audio与video不支持直接播放hls、flv等视频格式\n- 视频资源的请求和加载无法通过代码控制，也就无法实现以下功能\n  - 分段加载（节约流量）\n  - 清晰度无缝切换\n  - 精确预加载\n\n### MSE（拓展API）\n\n媒体源扩展API (Media Source Extensions)\n\n- 无插件在web端播放流媒体\n- 支持播放hIs、flv、 mp4等格式视频\n- 可实现视频分段加载、清晰度无缝切换、自适应码率、精确预加载等\n\n- 主流浏览器基本支持，除了IOS的Safari\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/57817e4755fb424cbda2d1810fb702d2~tplv-k3u1fbpfcp-watermark.image?)\n\n1. 创建mediaSource实例\n2. 创建指向mediaSource的URL\n3. 监听sourceopen事件\n4. 创建sourceBuffer\n5. 向sourceBuffer中加入数据\n6. 监听updateend事件\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bb5eaa1edf54ad69934d046c3963cf6~tplv-k3u1fbpfcp-watermark.image?)\n\n- 播放器播放流程\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/77c9b7a19ea64a7188ccb93eea57e152~tplv-k3u1fbpfcp-watermark.image?)\n\n\n\n## 流媒体协议\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae27e7b4cedb4a72a9648f0d8644b450~tplv-k3u1fbpfcp-watermark.image?)\n\nHLS全称是HTTP Live Streaming,是一个由Apple公司提出的基于HTTP的媒体流传输协议，用于实时音视频流的传输。目前HLS协议被广泛的应用于**视频点播**和直播领域。\n\n# 应用场景\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d112114f71f945a399ecd45fe24b31b1~tplv-k3u1fbpfcp-watermark.image?)\n\n- 点播/直播 -> 视频上传 -> 视频转码 \n- 图片  -> 支持一些新的图片\n- 云游戏 -> 不必再下繁琐的客户端等，运行在远端上，视频流来回传播（对延时要求高）\n\n# 总结感想\n\n本节课老师科普了Web多媒体技术的基本概念，如编码格式、封装格式、多媒体元素、流媒体协议等，并阐述了Web多媒体的多种应用场景\n\n> 本文引用的大部分内容来自刘立国老师的课以及MDN\n\n","sources":["xlog"],"summary":"PC时代：Flash等播放插件，富客户端。 移动互联网时代：Flash等逐渐被淘汰，HTML5出现了，但其支持视频格式等有限 Media Source Extensions ，支持多种视频格式等 编码格式\n图像基本概念\n图像分辨率：用于确定组成一副图像的像素数据…","attributes":[{"value":"web-multimedia-introductionmd","trait_type":"xlog_slug"}],"external_urls":["https://cosine.xlog.app/web-multimedia-introductionmd"],"date_published":"2022-01-30T14:30:17.000Z"}}}